<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<!-- Include Head Fragment -->
<head th:replace="~{layout/layout_fragment :: head('Chi tiết người dùng')}"></head>

<body class="d-flex flex-column min-vh-100">

    <!-- Include Admin Header -->
    <div th:replace="~{layout/layout_fragment :: admin-header}"></div>

    <div class="container-fluid flex-grow-1">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-md-2 col-lg-2 p-0">
                <div th:replace="~{layout/layout_fragment :: admin-sidebar('users')}"></div>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 col-lg-10 p-4">
                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="h4 mb-1">Chi tiết người dùng</h2>
                        <p class="text-muted mb-0">Thông tin chi tiết tài khoản nhân viên</p>
                    </div>
                    <a href="/admin/users" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Quay lại danh sách
                    </a>
                </div>

                <div class="card">
                    <div class="card-body">
                        <!-- User Detail Content -->
                        <div>
                            <div class="row">
                                <!-- Left Column: Basic Info -->
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0"><i class="bi bi-info-circle"></i> Thông tin cơ bản</h6>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-borderless">
                                                <tbody>
                                                    <tr>
                                                        <th width="40%">ID:</th>
                                                        <td th:text="${user.id}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Loại tài khoản:</th>
                                                        <td>
                                                            <span class="badge bg-primary">Nhân viên</span>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>Username:</th>
                                                        <td th:text="${user.username}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Họ và tên:</th>
                                                        <td th:text="${user.fullName}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Email:</th>
                                                        <td th:text="${user.email}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Số điện thoại:</th>
                                                        <td th:text="${user.phone ?: '-'}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Địa chỉ:</th>
                                                        <td th:text="${user.address ?: '-'}">-</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <!-- Right Column: Additional Info -->
                                <div class="col-md-6">
                                    <!-- User Specific Info -->
                                    <div class="card mb-3">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0"><i class="bi bi-shield-check"></i> Thông tin nhân viên</h6>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-borderless">
                                                <tbody>
                                                    <tr>
                                                        <th width="40%">Vai trò:</th>
                                                        <td>
                                                            <span th:each="role : ${user.roles}" 
                                                                  class="badge bg-success me-1"
                                                                  th:text="${role}">ROLE</span>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th>Phòng ban:</th>
                                                        <td th:text="${user.departmentName ?: '-'}">-</td>
                                                    </tr>
                                                    <tr>
                                                        <th>Trạng thái:</th>
                                                        <td>
                                                            <span th:if="${user.active}" class="badge bg-success">Đang hoạt động</span>
                                                            <span th:unless="${user.active}" class="badge bg-danger">Không hoạt động</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Timestamps -->
                                    <div class="card mb-3">
                                        <div class="card-header bg-secondary text-white">
                                            <h6 class="mb-0"><i class="bi bi-clock-history"></i> Thông tin hệ thống</h6>
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-borderless">
                                                <tbody>
                                                    <tr>
                                                        <th width="40%">Ngày tạo:</th>
                                                        <td th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm:ss') : '-'}">-</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="card">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0"><i class="bi bi-gear"></i> Thao tác</h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <!-- Toggle Active/Block Button -->
                                                <form th:action="@{/admin/users/{id}/toggle-active(id=${user.id})}" 
                                                      method="post"
                                                      th:attr="onsubmit=${user.active ? 'return confirm(\'Bạn có chắc chắn muốn chặn người dùng này?\');' : 'return confirm(\'Bạn có chắc chắn muốn mở khóa người dùng này?\');'}">
                                                    <input type="hidden" name="type" value="USER" />
                                                    <input type="hidden" name="active" th:value="${!user.active}" />
                                                    <button type="submit" 
                                                            th:classappend="${user.active ? 'btn-warning' : 'btn-success'}"
                                                            class="btn">
                                                        <i th:class="${user.active ? 'bi bi-lock' : 'bi bi-unlock'}"></i>
                                                        <span th:text="${user.active ? 'Chặn người dùng' : 'Mở khóa người dùng'}">Chặn</span>
                                                    </button>
                                                </form>

                                                <!-- Delete Button -->
                                                <form th:action="@{/admin/users/{id}/delete(id=${user.id})}" 
                                                      method="post"
                                                      onsubmit="return confirm('Bạn có chắc chắn muốn xóa người dùng này?');">
                                                    <input type="hidden" name="type" value="USER" />
                                                    <button type="submit" class="btn btn-danger w-100">
                                                        <i class="bi bi-trash"></i> Xóa người dùng
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Footer -->
    <footer th:replace="~{layout/layout_fragment :: admin-footer}"></footer>

    <!-- Include Scripts -->
    <th:block th:replace="~{layout/layout_fragment :: scripts}"></th:block>

</body>
</html>
